<!DOCTYPE html>
<html>
	<head>
		<script src="/public/ractive.js"></script>
		<script src='/public/ractive-events-keys.js'></script>
		<meta charset=utf-8 />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>fintfolk!</title>
		<link href="/public/normalize.css" media="all" rel="stylesheet" type="text/css" />
		<link href="/public/styles.css" media="screen" rel="stylesheet" type="text/css" />
	</head>

	<body>
		<div class="container" id="app">
		</div>
		<script id='template' type='text/ractive'>
			<div class='searchBar'>
				<span><strong>folk.deichman.no</strong></span>
				<input type='search' value='{{q}}'/>
				<select value='{{.selecedDept}}'>
					{{#departments}}
						<option value='{{ID}}'>{{Name}}</option>
					{{/departments}}
				</select>
			</div>
		</script>
		<script>
			var ractive = new Ractive({
				el: 'app',
				template: '#template',
				data: {}
			});

			var req = new XMLHttpRequest();
			req.open( 'GET', '/api/department', true );
			req.setRequestHeader( 'Content-Type', 'application/json; charset=UTF-8' );

			req.onerror = function( e ) {
				console.log( "failed to reach server: " + e.target.status );
			}

			req.onload = function( e) {
				var depts = JSON.parse( e.target.responseText);
				depts.forEach(function(d) {
					if ( d.Parent != 0 ) {
						d.Name = 'â€• ' + d.Name;
					}
				});
				depts.unshift( {"Name": "Hele biblioteket", "ID": 0, "Parent": 0} );
				ractive.set( 'departments',  depts );
			}

			req.send();

		</script>
	</body>
</html>
